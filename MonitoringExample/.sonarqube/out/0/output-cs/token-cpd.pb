Ò
I/Users/musakucuk/Projects/Monitoring/MonitoringExample/WeatherForecast.cs
	namespace 	
MonitoringExample
 
; 
public 
class 
WeatherForecast 
{ 
public 

DateOnly 
Date 
{ 
get 
; 
set  #
;# $
}% &
public 

int 
TemperatureC 
{ 
get !
;! "
set# &
;& '
}( )
public		 

int		 
TemperatureF		 
=>		 
$num		 !
+		" #
(		$ %
int		% (
)		( )
(		) *
TemperatureC		* 6
/		7 8
$num		9 ?
)		? @
;		@ A
public 

string 
? 
Summary 
{ 
get  
;  !
set" %
;% &
}' (
} ž 
A/Users/musakucuk/Projects/Monitoring/MonitoringExample/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Configuration 
. 
SetBasePath 
( 
	Directory 
. 
GetCurrentDirectory .
(. /
)/ 0
)0 1
.		 
AddJsonFile		 
(		 
$str		 #
,		# $
optional		% -
:		- .
false		/ 4
,		4 5
reloadOnChange		6 D
:		D E
true		F J
)		J K
.

 
AddJsonFile

 
(

 
$"

 
$str

 
{

  
builder

  '
.

' (
Environment

( 3
.

3 4
EnvironmentName

4 C
}

C D
$str

D I
"

I J
,

J K
optional

L T
:

T U
true

V Z
,

Z [
reloadOnChange

\ j
:

j k
true

l p
)

p q
. #
AddEnvironmentVariables 
( 
) 
; 
var 
connectionString 
= 
builder 
. 
Configuration ,
., -
GetConnectionString- @
(@ A
$strA M
)M N
;N O
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options 
. 
	UseNpgsql 
( 
connectionString "
!" #
)# $
)$ %
;% &
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
AddSingleton 
< 
IConfiguration ,
>, -
(- .
builder. 5
.5 6
Configuration6 C
)C D
;D E
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{ 
app   
.   

UseSwagger   
(   
)   
;   
app!! 
.!! 
UseSwaggerUI!! 
(!! 
)!! 
;!! 
}"" 
if%% 
(%% 
app%% 
.%% 
Environment%% 
.%% 
IsEnvironment%% !
(%%! "
$str%%" *
)%%* +
)%%+ ,
{&& 
app'' 
.'' 

UseSwagger'' 
('' 
)'' 
;'' 
app(( 
.(( 
UseSwaggerUI(( 
((( 
)(( 
;(( 
})) 
app,, 
.,, 
UseHttpMetrics,, 
(,, 
),, 
;,, 
app-- 
.-- 

MapMetrics-- 
(-- 
)-- 
;-- 
app// 
.// 
UseHttpsRedirection// 
(// 
)// 
;// 
app11 
.11 
UseAuthorization11 
(11 
)11 
;11 
app33 
.33 
MapControllers33 
(33 
)33 
;33 
app55 
.55 
Run55 
(55 
)55 	
;55	 
Ë
R/Users/musakucuk/Projects/Monitoring/MonitoringExample/Monitoring/CustomMetrics.cs
	namespace 	
MonitoringExample
 
. 

Monitoring &
{ 
public 

class 
CustomMetrics 
{ 
public 
CustomMetrics 
( 
) 
{ 	
}		 	
private 
static 
readonly 
	Histogram  )
_requestDuration* :
=; <
Metrics= D
.D E
CreateHistogramE T
(T U
$str .
,. /
$str '
,' (
new "
HistogramConfiguration &
{ 

LabelNames 
= 
new  
[  !
]! "
{# $
$str% -
,- .
$str/ 9
}: ;
} 
) 	
;	 

private 
static 
readonly 
Gauge  %
_openDbConnection& 7
=8 9
Metrics: A
.A B
CreateGaugeB M
(M N
$str 
, 
$str '
)' (
;( )
public 
static 
	Histogram 
RequestDuration  /
=>0 2
_requestDuration3 C
;C D
public 
static 
Gauge 
OpenDbConnection ,
=>- /
_openDbConnection0 A
;A B
public 
static 
void (
IncrementDbConnectionCounter 7
(7 8
)8 9
{ 	
_openDbConnection 
. 
Inc !
(! "
)" #
;# $
_openDbConnection   
.   
Publish   %
(  % &
)  & '
;  ' (
}!! 	
public## 
static## 
void## (
DecrementDbConnectionCounter## 7
(##7 8
)##8 9
{$$ 	
_openDbConnection%% 
.%% 
Dec%% !
(%%! "
)%%" #
;%%# $
_openDbConnection&& 
.&& 
Publish&& %
(&&% &
)&&& '
;&&' (
}'' 	
public** 
static** 
void** "
ObserveRequestDuration** 1
(**1 2
string**2 8
method**9 ?
,**? @
string**A G
endpoint**H P
,**P Q
double**R X
durationInSeconds**Y j
)**j k
{++ 	
_requestDuration,, 
.,, 
Labels,, #
(,,# $
method,,$ *
,,,* +
endpoint,,, 4
),,4 5
.,,5 6
Observe,,6 =
(,,= >
durationInSeconds,,> O
),,O P
;,,P Q
}-- 	
}// 
}00 Œ
E/Users/musakucuk/Projects/Monitoring/MonitoringExample/Models/User.cs
	namespace 	
MonitoringExample
 
. 
Models "
{ 
public 
class 
User 
{ 
public 
Guid	 
Id 
{ 
get 
; 
set 
; 
} 
public 
string	 
? 
Name 
{ 
get 
; 
set  
;  !
}" #
public 
string	 
? 
Surname 
{ 
get 
; 
set  #
;# $
}% &
public		 
bool			 
Gender		 
{		 
get		 
;		 
set		 
;		  
}		! "
}

 
} Ï
a/Users/musakucuk/Projects/Monitoring/MonitoringExample/Migrations/20240321082356_InitialCreate.cs
	namespace 	
MonitoringExample
 
. 

Migrations &
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Surname 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
Gender 
= 
table "
." #
Column# )
<) *
bool* .
>. /
(/ 0
type0 4
:4 5
$str6 ?
,? @
nullableA I
:I J
falseK P
)P Q
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder   
.   
	DropTable   &
(  & '
name!! 
:!! 
$str!! 
)!! 
;!! 
}"" 	
}## 
}$$ ó
S/Users/musakucuk/Projects/Monitoring/MonitoringExample/Data/ApplicationDbContext.cs
	namespace 	
MonitoringExample
 
. 
Data  
{ 
public		 
class		  
ApplicationDbContext		 "
:		# $
	DbContext		% .
{

 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
options5 <
)< =
:> ?
base@ D
(D E
optionsE L
)L M
{ 	
Database 
. 
EnsureCreated "
(" #
)# $
;$ %
Database 
. 
Migrate 
( 
) 
; 
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
null1 5
!5 6
;6 7
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
base 
. 
OnConfiguring 
( 
optionsBuilder -
)- .
;. /
CustomMetrics 
. (
IncrementDbConnectionCounter 6
(6 7
)7 8
;8 9
} 	
public 
override 
void 
Dispose $
($ %
)% &
{ 	
base 
. 
Dispose 
( 
) 
; 
CustomMetrics 
. (
DecrementDbConnectionCounter 6
(6 7
)7 8
;8 9
} 	
}   
}!! ”$
_/Users/musakucuk/Projects/Monitoring/MonitoringExample/Controllers/WeatherForecastController.cs
	namespace 	
MonitoringExample
 
. 
Controllers '
;' (
[

 
ApiController

 
]

 
[ 
Route 
( 
$str 
) 
] 
public 
class %
WeatherForecastController &
:' (
ControllerBase) 7
{ 
private 
readonly  
ApplicationDbContext )

_dbContext* 4
;4 5
public 
%
WeatherForecastController $
($ % 
ApplicationDbContext% 9
	dbContext: C
)C D
{ 

_dbContext 
= 
	dbContext 
; 
} 
private 
static 
readonly 
string "
[" #
]# $
	Summaries% .
=/ 0
new1 4
[4 5
]5 6
{ 
$str 
, 
$str 
, 
$str '
,' (
$str) /
,/ 0
$str1 7
,7 8
$str9 ?
,? @
$strA H
,H I
$strJ O
,O P
$strQ ]
,] ^
$str_ j
} 
; 
[ 
HttpGet 
( 
Name 
= 
$str (
)( )
]) *
public 

IEnumerable 
< 
WeatherForecast &
>& '
Get( +
(+ ,
), -
{ 
var 
	stopWatch 
= 
	Stopwatch !
.! "
StartNew" *
(* +
)+ ,
;, -
User 
user 
= 
new 
( 
) 
{   	
Id!! 
=!! 
Guid!! 
.!! 
NewGuid!! 
(!! 
)!! 
,!!  
Name"" 
="" 
$str"" 
,"" 
Surname## 
=## 
$str## 
,##  
Gender$$ 
=$$ 
true$$ 
}%% 	
;%%	 

Thread'' 
.'' 
Sleep'' 
('' 
$num'' 
)'' 
;'' 

_dbContext)) 
.)) 
Add)) 
()) 
user)) 
))) 
;)) 

_dbContext** 
.** 
SaveChanges** 
(** 
)**  
;**  !

_dbContext++ 
.++ 
Dispose++ 
(++ 
)++ 
;++ 
Console-- 
.-- 
	WriteLine-- 
(-- 
$str-- >
)--> ?
;--? @
	stopWatch// 
.// 
Stop// 
(// 
)// 
;// 
double00 
elapsedTime00 
=00 
	stopWatch00 &
.00& '
Elapsed00' .
.00. /
TotalMilliseconds00/ @
;00@ A
CustomMetrics22 
.22 "
ObserveRequestDuration22 ,
(22, -
$str22- 2
,222 3
$str224 H
,22H I
elapsedTime22J U
)22U V
;22V W
return44 

Enumerable44 
.44 
Range44 
(44  
$num44  !
,44! "
$num44# $
)44$ %
.44% &
Select44& ,
(44, -
index44- 2
=>443 5
new446 9
WeatherForecast44: I
{55 	
Date66 
=66 
DateOnly66 
.66 
FromDateTime66 (
(66( )
DateTime66) 1
.661 2
Now662 5
.665 6
AddDays666 =
(66= >
index66> C
)66C D
)66D E
,66E F
TemperatureC77 
=77 
Random77 !
.77! "
Shared77" (
.77( )
Next77) -
(77- .
-77. /
$num77/ 1
,771 2
$num773 5
)775 6
,776 7
Summary88 
=88 
	Summaries88 
[88  
Random88  &
.88& '
Shared88' -
.88- .
Next88. 2
(882 3
	Summaries883 <
.88< =
Length88= C
)88C D
]88D E
}99 	
)99	 

.:: 	
ToArray::	 
(:: 
):: 
;:: 
};; 
}<< 